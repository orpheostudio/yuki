<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#4a90e2">
    <meta name="description" content="SENA - Tecnologia com alma gentil. Assistente virtual inteligente.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SENA">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://i.imgur.com/lbi4vra.png">
    <title>SENA - Tecnologia com alma gentil</title>
    
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "tlya8thx8r");
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX"
     crossorigin="anonymous"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4a90e2;
            --secondary-color: #667eea;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            --shadow-sm: 0 2px 10px rgba(0,0,0,0.05);
            --shadow-md: 0 5px 20px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: white;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .menu-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .menu-btn:hover {
            background: #f0f0f0;
        }

        .header-right {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .header-link {
            padding: 8px 14px;
            background: #1a1a1a;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-size: 12px;
            transition: background 0.3s;
            white-space: nowrap;
        }

        .header-link:hover {
            background: #333;
        }

        .info-icon {
            width: 32px;
            height: 32px;
            border: 2px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .info-icon:hover {
            background: #333;
            color: white;
        }

        .sidebar {
            position: fixed;
            left: -100%;
            top: 0;
            width: 85%;
            max-width: 320px;
            height: 100vh;
            background: white;
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--primary-color);
            color: white;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: inherit;
            padding: 4px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            border-bottom: 1px solid #eee;
        }

        .sidebar-menu a, .sidebar-menu button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 18px 20px;
            color: #333;
            text-decoration: none;
            transition: background 0.3s;
            width: 100%;
            text-align: left;
            background: none;
            border: none;
            font-size: 15px;
            cursor: pointer;
        }

        .sidebar-menu a:hover, .sidebar-menu button:hover {
            background: #f5f5f5;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: var(--shadow-lg);
        }

        .modal.active {
            display: block;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: var(--primary-color);
            font-size: 24px;
        }

        .modal-content {
            color: #555;
            line-height: 1.8;
        }

        .faq-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }

        .faq-question {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .faq-answer {
            color: #666;
        }

        .hero {
            text-align: center;
            padding: 30px 20px;
        }

        .avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: white;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            overflow: hidden;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        h1 {
            font-size: clamp(32px, 8vw, 48px);
            color: var(--primary-color);
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .tagline {
            color: #666;
            font-size: clamp(14px, 4vw, 16px);
        }

        .chat-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 15px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .messages {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            max-height: 50vh;
            overflow-y: auto;
        }

        .message {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary-color);
            word-wrap: break-word;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .message-icon {
            font-size: 18px;
        }

        .message-text {
            color: #555;
            line-height: 1.6;
            font-size: 15px;
        }

        .suggestions-title {
            text-align: center;
            color: #999;
            font-size: 13px;
            margin: 20px 0 15px;
        }

        .suggestions {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }

        .suggestion-btn {
            background: #f8f4ff;
            border: none;
            padding: 15px 20px;
            border-radius: 12px;
            text-align: left;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            transition: all 0.3s;
        }

        .suggestion-btn:hover {
            background: #e9d8ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.15);
        }

        .input-container {
            position: relative;
            background: white;
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
        }

        .mic-btn, .video-btn {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: transform 0.3s;
        }

        .video-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .mic-btn:hover, .video-btn:hover {
            transform: scale(1.1);
        }

        .mic-btn:active, .video-btn:active {
            transform: scale(0.95);
        }

        .input-field {
            flex: 1;
            border: none;
            outline: none;
            font-size: 15px;
            color: #333;
            min-width: 0;
        }

        .input-field::placeholder {
            color: #aaa;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            min-width: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color) 0%, #357abd 100%);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: transform 0.3s;
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

        .video-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a1a;
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            width: 600px;
            z-index: 1001;
            box-shadow: var(--shadow-lg);
        }

        .video-modal.active {
            display: block;
        }

        .video-container {
            position: relative;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        #localVideo, #remoteVideo {
            width: 100%;
            border-radius: 10px;
            display: block;
        }

        .video-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .video-control-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .video-control-btn.start {
            background: #10b981;
            color: white;
        }

        .video-control-btn.end {
            background: #ef4444;
            color: white;
        }

        .video-control-btn:hover {
            transform: scale(1.05);
        }

        .install-prompt {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            animation: slideUp 0.3s ease;
        }

        .install-prompt.active {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .install-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100px);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        footer {
            text-align: center;
            padding: 15px;
            color: #666;
            font-size: 13px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            header {
                padding: 10px 15px;
            }

            .header-link {
                font-size: 11px;
                padding: 6px 12px;
            }

            .avatar {
                width: 80px;
                height: 80px;
            }

            .messages {
                padding: 15px;
                max-height: 40vh;
            }

            .message {
                padding: 12px;
            }

            .modal {
                padding: 20px;
                width: 95%;
            }

            .video-modal {
                width: 95%;
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .header-right {
                gap: 6px;
            }

            .header-link {
                display: none;
            }

            .header-link:first-child {
                display: block;
                font-size: 10px;
                padding: 5px 10px;
            }

            .input-container {
                padding: 10px 15px;
                gap: 8px;
            }

            .mic-btn, .video-btn, .send-btn {
                width: 36px;
                height: 36px;
                min-width: 36px;
                font-size: 16px;
            }
        }

        @media (min-width: 1024px) {
            .avatar {
                width: 120px;
                height: 120px;
            }

            .messages {
                max-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar Menu -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Menu</h3>
            <button class="close-btn" onclick="toggleSidebar()" aria-label="Fechar menu">×</button>
        </div>
        <ul class="sidebar-menu">
            <li><a href="mailto:sac.studiotsukiyo@outlook.com?subject=Reportar Bug"><span>📝</span> Reportar Bug</a></li>
            <li><a href="mailto:sac.studiotsukiyo@outlook.com?subject=Feedback"><span>💬</span> Feedback</a></li>
            <li><button onclick="openAboutModal()"><span>ℹ️</span> Sobre a Sena</button></li>
            <li><a href="https://studio.orpheostudio.com.br" target="_blank"><span>🎨</span> AmplaAI</a></li>
        </ul>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay" onclick="closeAll()"></div>

    <!-- Modal Sobre a Sena -->
    <div class="modal" id="aboutModal">
        <div class="modal-header">
            <h2>Sobre a Sena</h2>
            <button class="close-btn" onclick="closeModal('aboutModal')" aria-label="Fechar">×</button>
        </div>
        <div class="modal-content">
            <p>Sena é uma assistente virtual inteligente desenvolvida pela AmplaAI, projetada com alma gentil para tornar a tecnologia mais acessível e humana.</p>
            <br>
            <p><strong>Missão:</strong> Facilitar a interação entre pessoas e tecnologia através de conversas naturais e intuitivas.</p>
            <br>
            <p><strong>Tecnologia:</strong> Powered by Sena AI, oferecendo respostas precisas e contextualizadas.</p>
            <br>
            <p><strong>Desenvolvido por:</strong> AmplaAI</p>
        </div>
    </div>

    <!-- Modal FAQ -->
    <div class="modal" id="faqModal">
        <div class="modal-header">
            <h2>Dúvidas Frequentes</h2>
            <button class="close-btn" onclick="closeModal('faqModal')" aria-label="Fechar">×</button>
        </div>
        <div class="modal-content">
            <div class="faq-item">
                <div class="faq-question">O que é a Sena?</div>
                <div class="faq-answer">Sena é uma assistente virtual inteligente que usa tecnologia de IA para te ajudar com diversas tarefas e responder suas perguntas.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Como posso usar a Sena?</div>
                <div class="faq-answer">Basta digitar sua pergunta no campo de texto ou clicar no ícone do microfone para usar comandos de voz. A Sena responderá em tempo real.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">A Sena é gratuita?</div>
                <div class="faq-answer">Sim! A Sena é um serviço gratuito oferecido pela AmplaAI para facilitar o acesso à tecnologia.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Meus dados estão seguros?</div>
                <div class="faq-answer">Sim. Respeitamos sua privacidade e seguimos rigorosas políticas de proteção de dados. Consulte nossa Política de Privacidade para mais detalhes.</div>
            </div>
            <div class="faq-item">
                <div class="faq-question">Como reportar problemas?</div>
                <div class="faq-answer">Use a opção "Reportar Bug" no menu ou envie um email para sac.studiotsukiyo@outlook.com</div>
            </div>
        </div>
    </div>

    <!-- Modal de Video Chat -->
    <div class="video-modal" id="videoModal">
        <div class="modal-header">
            <h2 style="color: white;">Chamada de Vídeo</h2>
            <button class="close-btn" onclick="closeVideoModal()" style="color: white;" aria-label="Fechar">×</button>
        </div>
        <div class="video-container">
            <video id="localVideo" autoplay muted playsinline></video>
            <video id="remoteVideo" autoplay playsinline></video>
        </div>
        <div class="video-controls">
            <button class="video-control-btn start" onclick="startVideoCall()">📹 Iniciar Chamada</button>
            <button class="video-control-btn end" onclick="endVideoCall()">📞 Encerrar</button>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <span>📱 Instalar SENA no seu dispositivo?</span>
        <button class="install-btn" onclick="installPWA()">Instalar</button>
        <button class="close-btn" onclick="closeInstallPrompt()" style="color: #666;">×</button>
    </div>

    <header>
        <button class="menu-btn" onclick="toggleSidebar()" aria-label="Abrir menu">☰</button>
        <div class="header-right">
            <a href="https://termos.orpheostudio.com.br" target="_blank" class="header-link">Termos de Uso</a>
            <a href="https://politicas.orpheostudio.com.br" target="_blank" class="header-link">Políticas de Privacidade</a>
            <div class="info-icon" onclick="openFaqModal()" role="button" tabindex="0" aria-label="Ajuda">?</div>
        </div>
    </header>

    <div class="hero">
        <div class="avatar">
            <img src="https://i.imgur.com/lbi4vra.png" alt="Sena Avatar" class="avatar-img">
        </div>
        <h1>SENA</h1>
        <p class="tagline">Tecnologia com alma gentil</p>
    </div>

    <div class="chat-container">
        <div class="messages" id="messages">
            <div class="message">
                <div class="message-header">
                    <span class="message-icon">👋</span>
                    <span>Olá! Eu sou a Sena.</span>
                </div>
                <p class="message-text">A tecnologia com alma gentil.</p>
            </div>
            <div class="message">
                <p class="message-text">Como sou uma inteligência artificial, posso cometer erros. Considere verificar informações importantes.</p>
            </div>
        </div>

        <p class="suggestions-title">Sugestões</p>
        
        <div class="suggestions">
            <button class="suggestion-btn" onclick="askQuestion(this)">O que você pode fazer?</button>
            <button class="suggestion-btn" onclick="askQuestion(this)">Como baixo um app no celular?</button>
            <button class="suggestion-btn" onclick="askQuestion(this)">Pode me explicar sobre os termos e políticas da AmplaAI?</button>
            <button class="suggestion-btn" onclick="askQuestion(this)">Como doar para a AmplaAI?</button>
        </div>

        <div class="input-container">
            <button class="mic-btn" onclick="startVoice()" aria-label="Gravação de voz">🎤</button>
            <button class="video-btn" onclick="openVideoModal()" aria-label="Chamada de vídeo">📹</button>
            <input type="text" class="input-field" placeholder="Digite sua pergunta..." id="userInput" aria-label="Campo de mensagem">
            <button class="send-btn" onclick="sendMessage()" aria-label="Enviar mensagem">▲</button>
        </div>
    </div>

    <footer>
        Sena — Powered by AmplaAI
    </footer>

    <script>
        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registrado'))
                    .catch(err => console.log('Erro ao registrar Service Worker:', err));
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.add('active');
        });

        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA instalado');
                    }
                    deferredPrompt = null;
                    closeInstallPrompt();
                });
            }
        }

        function closeInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('active');
        }

        // Configuração da API Mistral
        const MISTRAL_API_KEY = 'NFuAj8PYUPcaf6tA1BjbyXuIeSjSA4sW';
        const conversationHistory = [];

        // WebRTC Configuration
        let localStream;
        let peerConnection;
        const configuration = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }

        function openAboutModal() {
            document.getElementById('aboutModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            toggleSidebar();
        }

        function openFaqModal() {
            document.getElementById('faqModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function closeAll() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('aboutModal').classList.remove('active');
            document.getElementById('faqModal').classList.remove('active');
            document.getElementById('videoModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function openVideoModal() {
            document.getElementById('videoModal').classList.add('active');
            document.getElementById('overlay').classList.add('active');
        }

        function closeVideoModal() {
            endVideoCall();
            document.getElementById('videoModal').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        async function startVideoCall() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                document.getElementById('localVideo').srcObject = localStream;
                
                peerConnection = new RTCPeerConnection(configuration);
                
                localStream.getTracks().forEach(track => {
                    peerConnection.addTrack(track, localStream);
                });
                
                peerConnection.ontrack = (event) => {
                    document.getElementById('remoteVideo').srcObject = event.streams[0];
                };
                
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        console.log('ICE candidate:', event.candidate);
                    }
                };
                
                alert('Em Desenvolvimento! (Em breve será liberado!)');
                
            } catch (error) {
                console.error('Erro ao acessar mídia:', error);
                alert('Erro ao acessar câmera/microfone. Verifique as permissões.');
            }
        }

        function endVideoCall() {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
            if (peerConnection) {
                peerConnection.close();
            }
            document.getElementById('localVideo').srcObject = null;
            document.getElementById('remoteVideo').srcObject = null;
        }

                function askQuestion(btn) {
            const question = btn.textContent;
            document.getElementById('userInput').value = question;
            sendMessage();
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) return;

            // Adiciona mensagem do usuário ao chat
            addMessageToChat('Você', '👤', message);
            userInput.value = '';

            // Mostra mensagem de "digitando..."
            showTypingIndicator();

            try {
                // Chama a API Mistral
                const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${MISTRAL_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'mistral-tiny',
                        messages: [
                            ...conversationHistory,
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }

                const data = await response.json();
                const botResponse = data.choices[0].message.content;

                // Atualiza histórico da conversa
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: botResponse }
                );

                // Mantém o histórico limitado para evitar excesso de tokens
                if (conversationHistory.length > 10) {
                    conversationHistory.splice(0, 2);
                }

                // Remove indicador de digitação e adiciona resposta
                removeTypingIndicator();
                addMessageToChat('Sena', '🤖', botResponse);

            } catch (error) {
                console.error('Erro:', error);
                removeTypingIndicator();
                addMessageToChat('Sena', '🤖', 'Ops! Acho que algo não saiu como eu planejei. você pode tentar novamente?');
            }
        }

        function addMessageToChat(sender, icon, text) {
            const messagesContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-icon">${icon}</span>
                    <span>${sender}</span>
                </div>
                <p class="message-text">${text}</p>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message';
            typingDiv.innerHTML = `
                <div class="message-header">
                    <span class="message-icon">🤖</span>
                    <span>Sena</span>
                </div>
                <p class="message-text" id="typing-text">Digitando<span class="typing-dots">.</span></p>
            `;
            
            messagesContainer.appendChild(typingDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            // Animação dos pontos
            let dots = 0;
            window.typingInterval = setInterval(() => {
                dots = (dots + 1) % 4;
                const dotsElement = typingDiv.querySelector('.typing-dots');
                dotsElement.textContent = '.'.repeat(dots);
            }, 500);
        }

        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
            if (window.typingInterval) {
                clearInterval(window.typingInterval);
            }
        }

        // Reconhecimento de voz
        let recognition = null;
        
        function startVoice() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Seu navegador não suporta reconhecimento de voz. Use Chrome ou Edge.');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'pt-BR';

            recognition.onstart = function() {
                document.getElementById('userInput').placeholder = "Ouvindo...";
                document.querySelector('.mic-btn').style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            };

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('userInput').value = transcript;
                document.getElementById('userInput').placeholder = "Digite sua pergunta...";
                document.querySelector('.mic-btn').style.background = 'linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%)';
                
                // Envia automaticamente a mensagem
                setTimeout(sendMessage, 500);
            };

            recognition.onerror = function(event) {
                console.error('Erro no reconhecimento de voz:', event.error);
                document.getElementById('userInput').placeholder = "Digite sua pergunta...";
                document.querySelector('.mic-btn').style.background = 'linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%)';
                
                if (event.error === 'not-allowed') {
                    alert('Permissão de microfone negada. Por favor, permita o acesso ao microfone.');
                }
            };

            recognition.onend = function() {
                document.getElementById('userInput').placeholder = "Digite sua pergunta...";
                document.querySelector('.mic-btn').style.background = 'linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%)';
            };

            recognition.start();
        }

        // Enviar mensagem com Enter
        document.getElementById('userInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Fechar modais com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAll();
            }
        });

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verifica se é mobile e sugere instalação do PWA
            if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                setTimeout(() => {
                    if (!window.matchMedia('(display-mode: standalone)').matches) {
                        document.getElementById('installPrompt').classList.add('active');
                    }
                }, 3000);
            }

            // Foca no input quando a página carrega
            document.getElementById('userInput').focus();
        });

        // Service Worker para PWA
        const registerServiceWorker = async () => {
            if ("serviceWorker" in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register("/sw.js");
                    if (registration.installing) {
                        console.log("Service worker installing");
                    } else if (registration.waiting) {
                        console.log("Service worker installed");
                    } else if (registration.active) {
                        console.log("Service worker active");
                    }
                } catch (error) {
                    console.error(`Registration failed with ${error}`);
                }
            }
        };

        registerServiceWorker();
    </script>
</body>
</html>