<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophia - Super Assistente</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/HPsXQqv.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --background-color: #F3F6FA; --bot-message-bg: #FFFFFF; --user-message-bg: #2C3E50;
            --text-primary: #2C3E50; --text-light: #FFFFFF; --text-secondary: #8A94A6;
            --border-color: #E0E5EC; --button-outline: #D1D9E6; --shadow-color: rgba(44, 62, 80, 0.1);
            --accent-color: #3498DB;
        }

        body.dark-mode {
            --background-color: #1A1A1A; --bot-message-bg: #2C2C2C; --user-message-bg: #3498DB;
            --text-primary: #EAEAEA; --text-light: #FFFFFF; --text-secondary: #888888;
            --border-color: #3D3D3D; --button-outline: #4A4A4A; --shadow-color: rgba(0, 0, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: #C8D0E7;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            transition: background-color 0.3s;
        }
        
        .container {
            width: 100%; max-width: 400px; height: 90vh; max-height: 850px;
            background-color: var(--background-color);
            border-radius: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 8px solid #fff;
            transition: background-color 0.3s;
        }
        .screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; transition: opacity 0.5s ease-in-out, visibility 0.5s; opacity: 1; visibility: visible; }
        .screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        .welcome-screen { justify-content: center; align-items: center; text-align: center; padding: 40px; }
        .welcome-avatar { width: 150px; height: 150px; margin-bottom: 2rem; }
        .welcome-avatar img { width: 100%; height: 100%; }
        .welcome-title { font-size: 1.5rem; color: var(--text-primary); font-weight: 500; margin-bottom: 2rem; }
        .primary-btn { width: 100%; padding: 16px; border: 1px solid var(--button-outline); border-radius: 14px; background-color: var(--bot-message-bg); color: var(--text-primary); font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .primary-btn:hover { background-color: var(--border-color); }

        .chat-screen { background-color: var(--background-color); }
        .chat-header { padding: 12px 16px; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        
        /* ATUALIZA√á√ÉO: Estilos para o grupo de t√≠tulo no header */
        .header-title-group { display: flex; align-items: center; gap: 12px; }
        .header-logo { height: 40px; }
        .header-name {
            font-size: 1.6rem;
            font-weight: 600;
            background: linear-gradient(90deg, #EC4899, #8B5CF6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }
        
        .chat-messages { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
        .message-group { display: flex; gap: 10px; margin-bottom: 10px; max-width: 90%; align-self: flex-start; align-items: flex-end; animation: fadeIn 0.4s ease-out; }
        .message-group.user { align-self: flex-end; }
        .bot-avatar { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; overflow: hidden; }
        .bot-avatar img { width: 100%; height: 100%; }
        .message-bubbles { display: flex; flex-direction: column; gap: 8px; }
        .message { padding: 12px 16px; border-radius: 20px; line-height: 1.5; word-wrap: break-word; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .bot-message { background-color: var(--bot-message-bg); color: var(--text-primary); border-bottom-left-radius: 5px; box-shadow: 0 4px 10px var(--shadow-color); }
        .user-message { background-color: var(--user-message-bg); color: var(--text-light); border-bottom-right-radius: 5px; align-self: flex-end; }
        
        .rich-card { border: 1px solid var(--border-color); }
        .rich-card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .rich-card-title { font-weight: 500; }
        .rich-card-body { font-size: 0.9rem; color: var(--text-secondary); }
        .rich-card-body b { color: var(--text-primary); }
        .rich-card-body a { color: var(--accent-color); text-decoration: none; }

        .quick-reply-area { padding: 10px 20px 0; display: flex; justify-content: flex-end; flex-wrap: wrap; gap: 8px; }
        .quick-reply { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--button-outline); color: var(--text-primary); background-color: var(--bot-message-bg); cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
        .quick-reply:hover { background-color: var(--border-color); }
        
        .chat-input-area { display: flex; align-items: center; padding: 15px; border-top: 1px solid var(--border-color); background-color: var(--background-color); flex-shrink: 0; gap: 10px; }
        .input-wrapper { display: flex; align-items: center; flex-grow: 1; border: 1px solid var(--border-color); background-color: var(--bot-message-bg); border-radius: 14px; }
        .chat-input { flex-grow: 1; border: none; background: transparent; padding: 14px 16px; font-size: 1rem; color: var(--text-primary); }
        .chat-input:focus { outline: none; }
        .icon-btn { background-color: var(--bot-message-bg); border: 1px solid var(--border-color); width: 48px; height: 48px; border-radius: 14px; font-size: 1.2rem; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
        .icon-btn:hover { color: var(--text-primary); }
        .icon-btn.listening { color: #E74C3C; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }

        .typing-indicator { align-self: flex-start; }
        .typing-dots { display: flex; gap: 5px; }
        .typing-dot { width: 8px; height: 8px; background-color: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(2) { animation-delay: .2s; }
        .typing-dot:nth-child(3) { animation-delay: .4s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: flex-end; z-index: 100; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background-color: var(--bot-message-bg); color: var(--text-primary); width: 100%; padding: 20px; border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.3s ease-out; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .menu-list { list-style: none; }
        .menu-list a, .menu-list button { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); text-decoration: none; font-size: 1rem; background: none; border: none; width: 100%; text-align: left; cursor: pointer; }
        .menu-list a:hover, .menu-list button:hover { background-color: var(--background-color); }
        .menu-list li:last-child button { border-bottom: none; }
        .menu-list i { margin-right: 15px; color: var(--text-secondary); width: 20px; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; margin-left: auto; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="screen welcome-screen" id="welcomeScreen">
            <div class="welcome-avatar">
                <img src="https://i.imgur.com/HPsXQqv.png" alt="Sophia Avatar">
            </div>
            <!-- ATUALIZA√á√ÉO: Nome alterado para Sophia -->
            <h1 class="welcome-title">Bem vindo! Eu sou a Sophia.</h1>
            <div class="welcome-actions">
                <button class="primary-btn" id="getStartedBtn">Come√ßar</button>
            </div>
        </div>

        <div class="screen chat-screen hidden" id="chatScreen">
            <header class="chat-header">
                <!-- ATUALIZA√á√ÉO: Header com logo e nome em gradiente -->
                <div class="header-title-group">
                    <img src="https://i.imgur.com/HPsXQqv.png" alt="Sophia Logo" class="header-logo">
                    <h1 class="header-name">Sophia</h1>
                </div>
            </header>
            <div class="chat-messages" id="chatMessages"></div>
            <div class="quick-reply-area" id="quickReplyArea"></div>
            <form class="chat-input-area" id="inputArea">
                <div class="input-wrapper">
                    <input type="text" class="chat-input" id="userInput" placeholder="Digite sua mensagem...">
                </div>
                <button type="submit" class="icon-btn" id="sendButton"><i class="fas fa-arrow-up"></i></button>
                <button type="button" class="icon-btn" id="micBtn" title="Usar Microfone"><i class="fas fa-microphone"></i></button>
                <button type="button" class="icon-btn" id="menuBtn" title="Menu"><i class="fas fa-ellipsis-h"></i></button>
            </form>
        </div>

        <div class="modal-overlay" id="menuOverlay">
            <div class="modal-content">
                <ul class="menu-list">
                    <li><button id="helpBtn"><i class="fas fa-question-circle"></i> Ajuda e Comandos</button></li>
                    <li>
                        <button style="display: flex; align-items: center; width: 100%;">
                            <i class="fas fa-moon"></i> Modo Escuro
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </button>
                    </li>
                    <li><a href="https://studiotsukiyo.bio.link" target="_blank"><i class="fas fa-star"></i> Studio Tsukiyo</a></li>
                    <li><button id="clearChatBtn"><i class="fas fa-trash"></i> Limpar e Reiniciar</button></li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const elements = {
                welcomeScreen: document.getElementById('welcomeScreen'),
                chatScreen: document.getElementById('chatScreen'),
                getStartedBtn: document.getElementById('getStartedBtn'),
                chatMessages: document.getElementById('chatMessages'),
                quickReplyArea: document.getElementById('quickReplyArea'),
                inputArea: document.getElementById('inputArea'),
                userInput: document.getElementById('userInput'),
                sendButton: document.getElementById('sendButton'),
                micBtn: document.getElementById('micBtn'),
                menuBtn: document.getElementById('menuBtn'),
                menuOverlay: document.getElementById('menuOverlay'),
                clearChatBtn: document.getElementById('clearChatBtn'),
                helpBtn: document.getElementById('helpBtn'),
                darkModeToggle: document.getElementById('darkModeToggle'),
            };

            // ATUALIZA√á√ÉO: Chaves do localStorage alteradas para 'sophia'
            let userName = localStorage.getItem('sophiaUserName') || '';
            let conversationState = 'IDLE'; 
            let riddleAnswer = '';
            let speechRecognition;

            const knowledgeBase = {
                greetings: ["Ol√°! Como vai?", "Oi! Que bom te ver.", "E a√≠! Tudo bem?"],
                // ATUALIZA√á√ÉO: Nome alterado para Sophia
                identity: "Eu sou a Sophia, uma assistente virtual criada pelo Studio Tsukiyo para te ajudar no dia a dia.",
                gratitude: ["De nada! Se precisar de mais alguma coisa, √© s√≥ chamar.", "Fico feliz em ajudar!"],
                farewell: ["At√© mais! Volte sempre que precisar.", "Tchau! Tenha um √≥timo dia."],
                fallback: "Desculpe, n√£o entendi. Que tal tentar uma das op√ß√µes abaixo ou digitar `/ajuda` para ver meus comandos?",
                animes: [ { title: "Attack on Titan", desc: "Humanidade luta por sobreviv√™ncia contra tit√£s gigantes." }, { title: "Jujutsu Kaisen", desc: "Feiticeiros lutam contra maldi√ß√µes para proteger o mundo." } ],
                musics: [ { title: "Blinding Lights", artist: "The Weeknd" }, { title: "As It Was", artist: "Harry Styles" } ],
                quotes: ["A persist√™ncia realiza o imposs√≠vel.", "O sucesso √© a soma de pequenos esfor√ßos repetidos diariamente."],
                jokes: ["O que o pato falou para a pata? Vem Qu√°!", "Por que a velhinha n√£o usa rel√≥gio? Porque ela √© uma sem hora."],
                riddles: [ { q: "O que √©, o que √©? Cai em p√© e corre deitado?", a: "chuva" }, { q: "Tenho cidades, mas n√£o casas. O que sou eu?", a: "mapa" } ]
            };

            const addMessage = (content, isUser = false) => {
                const messageGroup = document.createElement('div');
                messageGroup.className = `message-group ${isUser ? 'user' : ''}`;
                if (!isUser) messageGroup.innerHTML += `<div class="bot-avatar"><img src="https://i.imgur.com/HPsXQqv.png" alt="Avatar"></div>`;
                
                const bubblesContainer = document.createElement('div');
                bubblesContainer.className = 'message-bubbles';
                const messages = Array.isArray(content) ? content : [content];
                messages.forEach(msg => {
                    const bubble = document.createElement('div');
                    bubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                    bubble.innerHTML = msg;
                    bubblesContainer.appendChild(bubble);
                });
                
                messageGroup.appendChild(bubblesContainer);
                elements.chatMessages.appendChild(messageGroup);
                elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
                
                if (!isUser) speak(messages.join(' ').replace(/<[^>]*>/g, ''));
            };
            
            const showQuickReplies = (replies) => {
                elements.quickReplyArea.innerHTML = replies.map(reply => `<button class="quick-reply">${reply}</button>`).join('');
                document.querySelectorAll('.quick-reply').forEach(btn => {
                    btn.addEventListener('click', () => {
                        elements.userInput.value = btn.textContent;
                        handleUserInput();
                    });
                });
            };

            const showTypingIndicator = (show = true) => {
                document.querySelectorAll('.typing-indicator').forEach(el => el.remove());
                if (show) {
                    const typingHTML = `<div class="message-group typing-indicator"><div class="bot-avatar"><img src="https://i.imgur.com/HPsXQqv.png" alt="Avatar"></div><div class="message-bubbles"><div class="message bot-message typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div></div>`;
                    elements.chatMessages.innerHTML += typingHTML;
                    elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
                }
            };
            
            const startConversation = () => {
                if (userName) {
                    const greeting = new Date().getHours() < 12 ? "Bom dia" : new Date().getHours() < 18 ? "Boa tarde" : "Boa noite";
                    addMessage([`${greeting}, ${userName}!`, "Como posso te ajudar hoje?"]);
                } else {
                    addMessage(["Ol√°! Eu sou a Sophia.", "Como posso te chamar?"]);
                    conversationState = 'WAITING_FOR_NAME';
                    elements.userInput.focus();
                }
            };

            const handleUserInput = (event) => {
                if(event) event.preventDefault();
                const text = elements.userInput.value.trim();
                if (!text) return;
                
                addMessage(text, true);
                elements.userInput.value = '';
                elements.quickReplyArea.innerHTML = '';
                
                showTypingIndicator();
                const responseDelay = 800 + Math.random() * 800;
                setTimeout(() => generateResponse(text), responseDelay);
            };

            const generateResponse = (input) => {
                showTypingIndicator(false);
                const lowerInput = input.toLowerCase();

                if (conversationState === 'WAITING_FOR_NAME') {
                    userName = input.split(' ')[0];
                    localStorage.setItem('sophiaUserName', userName);
                    conversationState = 'IDLE';
                    addMessage([`Prazer em te conhecer, ${userName}!`, `O que voc√™ gostaria de fazer?`]);
                    showQuickReplies(["Recomende um anime", "/clima S√£o Paulo", "/noticias"]);
                    return;
                }
                
                if (conversationState === 'WAITING_FOR_RIDDLE_ANSWER') {
                    if (lowerInput.includes(riddleAnswer)) { addMessage("Parab√©ns, voc√™ acertou! üéâ"); } 
                    else { addMessage(`N√£o foi dessa vez. A resposta era: **${riddleAnswer}**.`); }
                    conversationState = 'IDLE';
                    showQuickReplies(["Me conte uma piada", "/ajuda"]);
                    return;
                }
                
                if (lowerInput.startsWith('/')) { handleCommand(lowerInput); return; }

                if (lowerInput.includes('anime')) { const a = knowledgeBase.animes.random(); addMessage(`Que tal <b style="color: #BF360C">${a.title}</b>? √â sobre: ${a.desc}`); }
                else if (lowerInput.includes('m√∫sica')) { const m = knowledgeBase.musics.random(); addMessage(`Recomendo <b style="color: #00796B">${m.title}</b> de ${m.artist}.`); }
                else if (lowerInput.includes('frase') || lowerInput.includes('motiva')) { addMessage(`Claro! <i>"${knowledgeBase.quotes.random()}"</i>`); }
                else if (lowerInput.includes('quem √© voc√™')) { addMessage(knowledgeBase.identity); }
                else if (lowerInput.includes('obrigad')) { addMessage(knowledgeBase.gratitude.random()); }
                else if (lowerInput.includes('tchau') || lowerInput.includes('adeus')) { addMessage(knowledgeBase.farewell.random()); }
                else if (lowerInput.includes('hora')) { addMessage(`Agora s√£o ${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}.`); }
                else if (lowerInput.includes('dia') || lowerInput.includes('data')) { addMessage(`Hoje √© ${new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}.`); }
                else {
                    addMessage(knowledgeBase.fallback);
                    showQuickReplies(["Recomende uma m√∫sica", "/calcular 10*5", "/ajuda"]);
                }
            };
            
            const handleCommand = (input) => {
                const [command, ...args] = input.substring(1).split(' ');
                const query = args.join(' ');

                switch(command) {
                    case 'ajuda': addMessage("<b>Comandos dispon√≠veis:</b><br>/clima [cidade]<br>/noticias<br>/buscar [termo]<br>/calcular [opera√ß√£o]<br>/piada<br>/charada"); break;
                    case 'clima': fetchWeather(query || 'S√£o Paulo'); break;
                    case 'noticias': fetchNews(); break;
                    case 'buscar': addMessage(`Aqui est√£o os resultados da busca para "${query}":<br><a href="https://www.google.com/search?q=${encodeURIComponent(query)}" target="_blank">Ver no Google</a>`); break;
                    case 'calcular':
                        try { addMessage(`O resultado √©: ${eval(query.replace(/[^-()\d/*+.]/g, ''))}`); }
                        catch { addMessage("N√£o consegui calcular isso."); }
                        break;
                    case 'piada': addMessage(knowledgeBase.jokes.random()); break;
                    case 'charada':
                        const riddle = knowledgeBase.riddles.random();
                        riddleAnswer = riddle.a;
                        conversationState = 'WAITING_FOR_RIDDLE_ANSWER';
                        addMessage([riddle.q, "Qual √© a sua resposta?"]);
                        elements.userInput.focus();
                        break;
                    default: addMessage("Comando n√£o reconhecido. Digite `/ajuda` para ver a lista.");
                }
            };

            const fetchApi = async (url, errorMessage) => {
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    return await response.json();
                } catch (error) {
                    console.error("API Error:", error);
                    addMessage(errorMessage);
                    return null;
                }
            };

            const fetchWeather = async (city) => {
                const apiKey = 'SUA_CHAVE_API_OPENWEATHERMAP'; 
                if(apiKey.includes('SUA_CHAVE')) { addMessage("A fun√ß√£o de clima precisa de uma chave de API para funcionar."); return; }
                const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=pt_br`;
                const data = await fetchApi(url, "N√£o consegui buscar o clima agora.");
                if (data) {
                    const weatherCard = `<div class="message bot-message rich-card"><div class="rich-card-header"><img src="https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png" width="40" height="40"><span class="rich-card-title">Tempo em ${data.name}</span></div><div class="rich-card-body"><b>${Math.round(data.main.temp)}¬∞C</b> (${data.weather[0].description})<br>Sensa√ß√£o de ${Math.round(data.main.feels_like)}¬∞C.</div></div>`;
                    addMessage([weatherCard]);
                }
            };
            
            const fetchNews = async () => {
                const apiKey = 'SUA_CHAVE_API_NEWSAPI';
                if(apiKey.includes('SUA_CHAVE')) { addMessage("A fun√ß√£o de not√≠cias precisa de uma chave de API para funcionar."); return; }
                const url = `https://newsapi.org/v2/top-headlines?country=br&pageSize=5&apiKey=${apiKey}`;
                const data = await fetchApi(url, "N√£o consegui buscar as not√≠cias agora.");
                if (data && data.articles) {
                    const articles = data.articles.map(article => `<b>- <a href="${article.url}" target="_blank">${article.title}</a></b>`).join('<br>');
                    addMessage(`Principais not√≠cias de hoje no Brasil:<br><div class="rich-card-body">${articles}</div>`);
                }
            };
            
            const initializeSpeech = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) { elements.micBtn.style.display = 'none'; return; }
                speechRecognition = new SpeechRecognition();
                speechRecognition.lang = 'pt-BR';
                speechRecognition.continuous = false;
                speechRecognition.onstart = () => elements.micBtn.classList.add('listening');
                speechRecognition.onend = () => elements.micBtn.classList.remove('listening');
                speechRecognition.onresult = (event) => { elements.userInput.value = event.results[0][0].transcript; handleUserInput(); };
            };
            
            const speak = (text) => {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                speechSynthesis.speak(utterance);
            };
            
            const toggleTheme = () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('sophiaTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            };

            // Init
            elements.getStartedBtn.addEventListener('click', () => {
                elements.welcomeScreen.classList.add('hidden');
                elements.chatScreen.classList.remove('hidden');
                startConversation();
            });
            elements.inputArea.addEventListener('submit', handleUserInput);
            elements.micBtn.addEventListener('click', () => speechRecognition?.start());
            elements.menuBtn.addEventListener('click', () => elements.menuOverlay.classList.add('active'));
            elements.menuOverlay.addEventListener('click', (e) => { if (e.target === elements.menuOverlay) elements.menuOverlay.classList.remove('active'); });
            
            elements.clearChatBtn.addEventListener('click', () => {
                elements.chatMessages.innerHTML = '';
                elements.menuOverlay.classList.remove('active');
                localStorage.removeItem('sophiaUserName');
                userName = '';
                startConversation();
            });
            elements.helpBtn.addEventListener('click', () => {
                elements.menuOverlay.classList.remove('active');
                handleCommand('/ajuda');
            });
            elements.darkModeToggle.addEventListener('change', toggleTheme);

            if (localStorage.getItem('sophiaTheme') === 'dark') {
                document.body.classList.add('dark-mode');
                elements.darkModeToggle.checked = true;
            }
            Array.prototype.random = function() { return this[Math.floor(Math.random() * this.length)]; };
            initializeSpeech();
        });
    </script>
</body>
</html>
