<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yuki</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/rbb0mx4.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --background-color: #F3F6FA; --bot-message-bg: #FFFFFF; --user-message-bg: #2C3E50;
            --text-primary: #2C3E50; --text-light: #FFFFFF; --text-secondary: #8A94A6;
            --border-color: #E0E5EC; --button-outline: #D1D9E6; --shadow-color: rgba(44, 62, 80, 0.1);
            --accent-color: #3498DB; --orb-gradient: linear-gradient(135deg, #EC4899, #8B5CF6);
        }
        body.dark-mode {
            --background-color: #1A1A1A; --bot-message-bg: #2C2C2C; --user-message-bg: #3498DB;
            --text-primary: #EAEAEA; --text-light: #FFFFFF; --text-secondary: #888888;
            --border-color: #3D3D3D; --button-outline: #4A4A4A; --shadow-color: rgba(0, 0, 0, 0.2);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        body { background-color: #C8D0E7; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 10px; transition: background-color 0.3s; }
        .container {
            width: 100%; max-width: 400px; height: 90vh; max-height: 850px;
            background-color: var(--background-color); border-radius: 40px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden; display: flex; flex-direction: column; position: relative; border: 8px solid #fff; transition: background-color 0.3s;
        }
        .screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; transition: opacity 0.5s ease-in-out, visibility 0.5s; opacity: 1; visibility: visible; }
        .screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        /* TELA DE BOAS-VINDAS */
        .welcome-screen { justify-content: center; align-items: center; text-align: center; padding: 40px; }
        .welcome-avatar { width: 150px; height: 150px; margin-bottom: 2rem; }
        .welcome-avatar img { width: 100%; height: 100%; }
        .welcome-title { font-size: 1.5rem; color: var(--text-primary); font-weight: 500; margin-bottom: 2rem; }
        .primary-btn { width: 100%; padding: 16px; border: 1px solid var(--button-outline); border-radius: 14px; background-color: var(--bot-message-bg); color: var(--text-primary); font-size: 1rem; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .primary-btn:hover { background-color: var(--border-color); }

        /* TELA DE CHAT */
        .chat-screen { background-color: var(--background-color); }
        .chat-header { padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border-color); flex-shrink: 0; }
        .header-title-group { display: flex; align-items: center; gap: 12px; }
        .header-logo { height: 40px; }
        .header-name { font-size: 1.6rem; font-weight: 600; background: linear-gradient(90deg, #EC4899, #8B5CF6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .chat-body { flex-grow: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .assistant-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; text-align: center; padding: 20px;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .assistant-ui.hidden { opacity: 0; transform: scale(0.9); pointer-events: none; }
        .greeting-text { font-size: 1.8rem; font-weight: 300; color: var(--text-secondary); }
        .greeting-text b { font-weight: 500; color: var(--text-primary); }
        .help-text { font-size: 1.1rem; color: var(--text-primary); margin-top: 8px; }

        .orb {
            width: 150px; height: 150px; border-radius: 50%;
            background: var(--orb-gradient); margin: 40px 0; position: relative;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
            animation: pulse 4s infinite ease-in-out; transition: all 0.4s ease;
        }
        .orb::before, .orb::after {
            content: ''; position: absolute; width: 12px; height: 24px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 6px; top: 50%; transform: translateY(-50%); transition: all 0.4s ease;
        }
        .orb::before { left: 45px; } .orb::after { right: 45px; }
        @keyframes pulse { 0%, 100% { transform: scale(1); box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(139, 92, 246, 0.4); } }
        .orb.thinking { animation: thinking 2s infinite linear; }
        @keyframes thinking { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .orb.listening { animation: none; transform: scale(1.1); }
        .orb.listening::before, .orb.listening::after { opacity: 0; }
        .listening-ring { position: absolute; top: 50%; left: 50%; border: 2px solid #fff; border-radius: 50%; transform: translate(-50%, -50%) scale(1); opacity: 0; animation: listening-wave 1.5s infinite ease-out; }
        @keyframes listening-wave { from { transform: translate(-50%, -50%) scale(1); opacity: 0.6; } to { transform: translate(-50%, -50%) scale(2); opacity: 0; } }

        .chat-messages {
            flex-grow: 1; overflow-y: auto; padding: 20px;
            display: flex; flex-direction: column;
            opacity: 0; transition: opacity 0.5s ease;
            scroll-behavior: smooth;
        }
        .chat-messages.active { opacity: 1; }
        .message-group { display: flex; gap: 10px; margin-bottom: 10px; max-width: 90%; align-self: flex-start; align-items: flex-end; animation: fadeIn 0.4s ease-out; }
        .message-group.user { align-self: flex-end; }
        .bot-avatar { width: 40px; height: 40px; border-radius: 50%; flex-shrink: 0; overflow: hidden; }
        .bot-avatar img { width: 100%; height: 100%; }
        .message-bubbles { display: flex; flex-direction: column; gap: 8px; }
        .message { padding: 12px 16px; border-radius: 20px; line-height: 1.5; word-wrap: break-word; }
        .bot-message { background-color: var(--bot-message-bg); color: var(--text-primary); border-bottom-left-radius: 5px; box-shadow: 0 4px 10px var(--shadow-color); }
        .user-message { background-color: var(--user-message-bg); color: var(--text-light); border-bottom-right-radius: 5px; align-self: flex-end; }
        .message-timestamp { font-size: 0.75rem; color: var(--text-secondary); opacity: 0.8; margin-top: 6px; text-align: right; }
        .message strong { font-weight: 600; } .message em { font-style: italic; }

        .quick-reply-area { padding: 10px 20px 0; display: flex; justify-content: flex-end; flex-wrap: wrap; gap: 8px; }
        .quick-reply { padding: 8px 16px; border-radius: 20px; border: 1px solid var(--button-outline); color: var(--text-primary); background-color: var(--bot-message-bg); cursor: pointer; transition: all 0.2s; font-size: 0.9rem; }
        
        .chat-input-area { display: flex; align-items: center; padding: 15px; border-top: 1px solid var(--border-color); background-color: var(--background-color); flex-shrink: 0; gap: 10px; }
        .input-wrapper { display: flex; align-items: center; flex-grow: 1; border: 1px solid var(--border-color); background-color: var(--bot-message-bg); border-radius: 14px; }
        .chat-input { flex-grow: 1; border: none; background: transparent; padding: 14px 16px; font-size: 1rem; color: var(--text-primary); }
        .icon-btn { background-color: var(--bot-message-bg); border: 1px solid var(--border-color); width: 48px; height: 48px; border-radius: 14px; font-size: 1.2rem; color: var(--text-secondary); cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
        
        .typing-indicator { align-self: flex-start; }
        .typing-dots { display: flex; gap: 5px; }
        .typing-dot { width: 8px; height: 8px; background-color: var(--text-secondary); border-radius: 50%; animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(2) { animation-delay: .2s; } .typing-dot:nth-child(3) { animation-delay: .4s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }

        .modal-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4); display: none; justify-content: center; align-items: flex-end; z-index: 100; opacity: 0; transition: opacity 0.3s ease; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-content { background-color: var(--bot-message-bg); color: var(--text-primary); width: 100%; padding: 20px; border-radius: 20px 20px 0 0; transform: translateY(100%); transition: transform 0.3s ease-out; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        .menu-list { list-style: none; }
        .menu-list a, .menu-list button { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); text-decoration: none; font-size: 1rem; background: none; border: none; width: 100%; text-align: left; cursor: pointer; }
        .menu-list i { margin-right: 15px; color: var(--text-secondary); width: 20px; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; margin-left: auto; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(20px); }

        .toast-notification {
            position: absolute; top: -100px; left: 50%; transform: translateX(-50%);
            background-color: var(--user-message-bg); color: var(--text-light);
            padding: 12px 20px; border-radius: 10px; font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 200; transition: top 0.4s ease-in-out;
        }
        .toast-notification.show { top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="screen welcome-screen" id="welcomeScreen">
            <div class="welcome-avatar"><img src="https://i.imgur.com/rbb0mx4.png" alt="Hanabi Avatar"></div>
            <h1 class="welcome-title">Bem vindo(a)! Eu sou a Yuki.</h1>
            <div class="welcome-actions"><button class="primary-btn" id="getStartedBtn">Come√ßar</button></div>
        </div>

        <div class="screen chat-screen hidden" id="chatScreen">
            <header class="chat-header">
                <div class="header-title-group">
                    <img src="https://i.imgur.com/rbb0mx4.png" alt="Hanabi Logo" class="header-logo">
                    <h1 class="header-name">Yuki</h1>
                </div>
                <div>
                    <button type="button" class="icon-btn" id="menuBtn" title="Menu" style="width: 40px; height: 40px;"><i class="fas fa-ellipsis-h"></i></button>
                </div>
            </header>
            
            <div class="chat-body">
                <div class="assistant-ui" id="assistantUI">
                    <p class="greeting-text">Ol√°, <b id="greetingName">visitante</b>!</p>
                    <p class="help-text">Como posso te ajudar hoje?</p>
                    <div class="orb" id="orb"></div>
                </div>

                <div class="chat-messages" id="chatMessages"></div>
            </div>

            <div class="quick-reply-area" id="quickReplyArea"></div>
            
            <form class="chat-input-area" id="inputArea">
                <div class="input-wrapper">
                    <input type="text" class="chat-input" id="userInput" placeholder="Digite sua mensagem...">
                </div>
                <button type="submit" class="icon-btn" id="sendButton"><i class="fas fa-arrow-up"></i></button>
                <button type="button" class="icon-btn" id="micBtn" title="Usar Microfone"><i class="fas fa-microphone"></i></button>
            </form>
        </div>

        <div class="modal-overlay" id="menuOverlay">
            <div class="modal-content">
                <ul class="menu-list">
                    <li><button id="helpBtn"><i class="fas fa-question-circle"></i> Ajuda e Comandos</button></li>
                    <li><button style="display: flex; align-items: center; width: 100%;"><i class="fas fa-moon"></i> Modo Escuro<label class="switch"><input type="checkbox" id="darkModeToggle"><span class="slider"></span></label></button></li>
                    <li><a href="https://naotodev1.github.io/Nova" target="_blank"><i class="fas fa-rocket"></i> Conhe√ßa a Nova</a></li>
                    <li><a href="https://naotodev1.github.io/terms-e-policy" target="_blank"><i class="fas fa-file-contract"></i> Termos de Uso</a></li>
                    <li><a href="https://studiotsukiyo.bio.link" target="_blank"><i class="fas fa-star"></i> Studio Tsukiyo</a></li>
                    <li><button id="aboutDevBtn"><i class="fas fa-code"></i> Sobre o Dev: Naoto Dev</button></li>
                    <li><button id="aboutHanabiBtn"><i class="fas fa-info-circle"></i> Sobre a Yuki</button></li>
                    <li><button id="clearChatBtn"><i class="fas fa-trash"></i> Limpar e Reiniciar</button></li>
                </ul>
            </div>
        </div>
        <div class="toast-notification" id="toast"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const elements = {
                welcomeScreen: document.getElementById('welcomeScreen'),
                chatScreen: document.getElementById('chatScreen'),
                getStartedBtn: document.getElementById('getStartedBtn'),
                chatMessages: document.getElementById('chatMessages'),
                quickReplyArea: document.getElementById('quickReplyArea'),
                inputArea: document.getElementById('inputArea'),
                userInput: document.getElementById('userInput'),
                micBtn: document.getElementById('micBtn'),
                menuBtn: document.getElementById('menuBtn'),
                menuOverlay: document.getElementById('menuOverlay'),
                clearChatBtn: document.getElementById('clearChatBtn'),
                helpBtn: document.getElementById('helpBtn'),
                aboutDevBtn: document.getElementById('aboutDevBtn'),
                aboutHanabiBtn: document.getElementById('aboutHanabiBtn'),
                darkModeToggle: document.getElementById('darkModeToggle'),
                assistantUI: document.getElementById('assistantUI'),
                greetingName: document.getElementById('greetingName'),
                orb: document.getElementById('orb'),
                toast: document.getElementById('toast'),
            };

            let userName = localStorage.getItem('hanabiUserName') || '';
            let conversationState = 'IDLE';
            let riddleAnswer = '';
            let speechRecognition;
            let isConversationActive = false;
            
            Array.prototype.random = function() { return this[Math.floor(Math.random() * this.length)]; };

            const knowledgeBase = {
                greetings: ["Ol√°! Como vai?", "Oi! Que bom te ver.", "E a√≠! Tudo bem?"],
                identity: "Eu sou a Yuki, uma assistente virtual criada pelo Studio Tsukiyo Platforms para te ajudar no dia a dia.",
                gratitude: ["De nada! Se precisar de mais alguma coisa, √© s√≥ chamar.", "Fico feliz em ajudar!"],
                farewell: ["At√© mais! Volte sempre que precisar.", "Tchau! Tenha um √≥timo dia."],
                fallback: "Desculpe, n√£o entendi. Que tal tentar uma das op√ß√µes abaixo ou digitar `/ajuda` para ver meus comandos?",
                jokes: ["O que o pato falou para a pata? Vem Qu√°!", "Por que a velhinha n√£o usa rel√≥gio? Porque ela √© uma sem hora."],
                riddles: [ { q: "O que √©, o que √©? Cai em p√© e corre deitado?", a: "chuva" }, { q: "Tenho cidades, mas n√£o casas. O que sou eu?", a: "mapa" } ],
               const animes = [
    { title: "Fullmetal Alchemist: Brotherhood", desc: "Dois irm√£os alquimistas tentam restaurar seus corpos ap√≥s um experimento que deu errado." },
    { title: "Steins;Gate", desc: "Um grupo de amigos descobre acidentalmente como enviar mensagens para o passado, desencadeando uma s√©rie de eventos." },
    { title: "Hunter x Hunter", desc: "Um garoto parte em uma jornada para encontrar seu pai e se tornar um Hunter." },
    { title: "Gintama", desc: "Um samurai vagabundo luta contra alien√≠genas em um Jap√£o feudal alternativo." },
    { title: "Clannad: After Story", desc: "A sequ√™ncia emocional de Clannad, explorando a vida adulta e os desafios do casamento e da paternidade." },
    { title: "Your Lie in April", desc: "Um prod√≠gio do piano encontra inspira√ß√£o e cura emocional ao conhecer uma violinista." },
    { title: "Cowboy Bebop", desc: "Acompanhe um grupo de ca√ßadores de recompensas pelo espa√ßo em uma jornada cheia de a√ß√£o e reflex√£o." },
    { title: "Code Geass: Lelouch of the Rebellion", desc: "Um jovem recebe o poder do Geass e busca derrubar um imp√©rio tir√¢nico." },
    { title: "Made in Abyss", desc: "Uma garota desce em um abismo misterioso em busca de sua m√£e, enfrentando perigos inimagin√°veis." },
    { title: "Mob Psycho 100", desc: "Um jovem com poderes ps√≠quicos tenta viver uma vida normal enquanto enfrenta dilemas emocionais." },
    { title: "Jujutsu Kaisen", desc: "Um estudante ingere um objeto amaldi√ßoado e se v√™ envolvido em batalhas contra maldi√ß√µes." },
    { title: "Frieren: Beyond Journey's End", desc: "Uma maga imortal reflete sobre sua jornada e as amizades formadas ap√≥s a derrota do Rei Dem√¥nio." },
    { title: "Attack on Titan", desc: "Em um mundo devastado por gigantes devoradores de humanos, um grupo de soldados luta pela sobreviv√™ncia." },
    { title: "Death Note", desc: "Um estudante encontra um caderno que permite matar qualquer pessoa cujo nome seja escrito nele." },
    { title: "Neon Genesis Evangelion", desc: "Jovens pilotos de mechas enfrentam criaturas misteriosas enquanto lidam com seus pr√≥prios traumas." },
    { title: "One Piece", desc: "Um grupo de piratas busca o tesouro lend√°rio conhecido como One Piece." },
    { title: "Naruto", desc: "Acompanhe a jornada de um jovem ninja em busca de reconhecimento e poder." },
    { title: "My Hero Academia", desc: "Em um mundo onde quase todos t√™m superpoderes, um jovem sem habilidades sonha em se tornar um her√≥i." },
    { title: "Haikyuu!!", desc: "A hist√≥ria de um time de v√¥lei escolar e sua luta para se tornar o melhor do Jap√£o." },
    { title: "Vinland Saga", desc: "Acompanhe a vida de um jovem viking em busca de vingan√ßa e reden√ß√£o." },
    { title: "The Rising of the Shield Hero", desc: "Um homem √© transportado para outro mundo e se torna o her√≥i do escudo, enfrentando desafios e trai√ß√µes." },
    { title: "Kaguya-sama: Love is War", desc: "Dois estudantes de elite travam uma guerra psicol√≥gica para for√ßar o outro a confessar seu amor." },
    { title: "Mob Psycho 100 II", desc: "Continua√ß√£o das aventuras de Mob, agora enfrentando novos desafios e amadurecendo emocionalmente." },
    { title: "Demon Slayer: Kimetsu no Yaiba", desc: "Um jovem se torna um ca√ßador de dem√¥nios para salvar sua irm√£ transformada em dem√¥nio." },
    { title: "Re:Zero ‚àí Starting Life in Another World", desc: "Um jovem √© transportado para outro mundo e descobre que pode voltar no tempo cada vez que morre." },
    { title: "Toradora!", desc: "Uma com√©dia rom√¢ntica sobre dois estudantes com personalidades fortes que se ajudam a conquistar seus amores." },
    { title: "FLCL", desc: "Uma hist√≥ria surreal e energ√©tica sobre a adolesc√™ncia e o crescimento pessoal." },
    { title: "Ghost in the Shell: Stand Alone Complex", desc: "Em um futuro cyberpunk, uma unidade de elite combate crimes cibern√©ticos." },
    { title: "Cowboy Bebop: The Movie", desc: "Os ca√ßadores de recompensas enfrentam um novo inimigo em uma miss√£o no espa√ßo." },
    { title: "Samurai Champloo", desc: "Tr√™s viajantes improv√°veis percorrem o Jap√£o feudal em uma jornada cheia de a√ß√£o e m√∫sica." },
    { title: "Berserk", desc: "A hist√≥ria sombria de um mercen√°rio em busca de vingan√ßa em um mundo medieval brutal." },
    { title: "JoJo's Bizarre Adventure", desc: "Uma fam√≠lia luta contra for√ßas sobrenaturais ao longo de v√°rias gera√ß√µes." },
    { title: "Black Clover", desc: "Dois √≥rf√£os competem para se tornar o Rei Mago em um mundo onde todos t√™m magia." },
    { title: "Bleach", desc: "Um adolescente ganha poderes de um ceifador de almas e deve proteger os vivos e os mortos." },
    { title: "Tokyo Ghoul", desc: "Um jovem se transforma em meio-ghoul ap√≥s um acidente e deve aprender a viver entre humanos e ghouls." },
    { title: "Akira", desc: "Em um futuro p√≥s-apocal√≠ptico, um jovem com poderes ps√≠quicos amea√ßa destruir a cidade." },
    { title: "Mushishi", desc: "Um homem viaja pelo Jap√£o investigando fen√¥menos misteriosos causados por seres chamados mushi." },
    { title: "Anohana: The Flower We Saw That Day", desc: "Um grupo de amigos se re√∫ne para lidar com a perda de um ente querido." },
    { title: "March Comes in Like a Lion", desc: "Um jovem jogador de shogi luta contra a depress√£o e encontra apoio em uma fam√≠lia." },
    { title: "Erased", desc: "Um homem viaja no tempo para impedir o sequestro e assassinato de uma crian√ßa." },
    { title: "Made in Abyss: Dawn of the Deep Soul", desc: "Continua√ß√£o da jornada perigosa no abismo misterioso." },
    { title: "The Promised Neverland", desc: "Crian√ßas em um orfanato descobrem um segredo sombrio e planejam uma fuga." },
    { title: "K-On!", desc: "Cinco garotas formam uma banda escolar e lidam com os desafios da vida adolescente." },
    { title: "Fruits Basket", desc: "Uma jovem se envolve com uma fam√≠lia que carrega uma maldi√ß√£o." },
    { title: "Mob Psycho 100 III", desc: "A terceira temporada segue Mob enquanto ele enfrenta novos desafios e cresce como pessoa." },
    { title: "One Punch Man", desc: "Um her√≥i invenc√≠vel busca um advers√°rio digno de sua for√ßa." },
    { title: "Attack on Titan: The Final Season", desc: "A √∫ltima temporada da luta √©pica contra os tit√£s." },
    { title: "Yuri on Ice", desc: "Um patinador art√≠stico luta para se recuperar de uma derrota e encontrar seu caminho." },
    { title: "Dorohedoro", desc: "Um homem com cabe√ßa de r√©ptil busca descobrir sua verdadeira identidade em um mundo ca√≥tico." },
    { title: "Beastars", desc: "Em um mundo habitado por animais antropom√≥rficos, um lobo lida com seus sentimentos e identidade." },
    { title: "The Ancient Magus' Bride", desc: "Uma jovem √© comprada por um mago e se torna sua aprendiz e noiva." },
    { title: "Mob Psycho 100: Reigen", desc: "Um especial que explora mais sobre o mentor de Mob, Reigen." },
    { title: "Black Lagoon", desc: "Mercen√°rios enfrentam perigos em uma cidade cheia de criminosos internacionais." },
    { title: "Trigun", desc: "Um pistoleiro com um passado misterioso viaja pelo deserto em busca de reden√ß√£o." },
    { title: "Hellsing", desc: "Uma organiza√ß√£o secreta combate criaturas sobrenaturais com a ajuda de um vampiro." },
    { title: "Soul Eater", desc: "Estudantes treinam para se tornar ca√ßadores de almas em uma escola especializada." },
    { title: "Noragami", desc: "Um deus menor tenta ganhar seguidores enquanto ajuda humanos com seus problemas." },
    { title: "Black Clover: Sword of the Wizard King", desc: "Um filme que expande a hist√≥ria do anime com novas aventuras." }
                ];
               const musics = [
    { title: "Blinding Lights", artist: "The Weeknd" },
    { title: "Save Your Tears", artist: "The Weeknd" },
    { title: "Bohemian Rhapsody", artist: "Queen" },
    { title: "Don't Start Now", artist: "Dua Lipa" },
    { title: "Levitating", artist: "Dua Lipa" },
    { title: "Shape of You", artist: "Ed Sheeran" },
    { title: "Perfect", artist: "Ed Sheeran" },
    { title: "Bad Guy", artist: "Billie Eilish" },
    { title: "Happier Than Ever", artist: "Billie Eilish" },
    { title: "Smells Like Teen Spirit", artist: "Nirvana" },
    { title: "Enter Sandman", artist: "Metallica" },
    { title: "Thriller", artist: "Michael Jackson" },
    { title: "Billie Jean", artist: "Michael Jackson" },
    { title: "Rolling in the Deep", artist: "Adele" },
    { title: "Hello", artist: "Adele" },
    { title: "Watermelon Sugar", artist: "Harry Styles" },
    { title: "As It Was", artist: "Harry Styles" },
    { title: "Uptown Funk", artist: "Mark Ronson ft. Bruno Mars" },
    { title: "24K Magic", artist: "Bruno Mars" },
    { title: "Someone Like You", artist: "Adele" },
    { title: "Stay", artist: "The Kid LAROI & Justin Bieber" },
    { title: "Peaches", artist: "Justin Bieber ft. Daniel Caesar & Giveon" },
    { title: "Drivers License", artist: "Olivia Rodrigo" },
    { title: "Good 4 U", artist: "Olivia Rodrigo" },
    { title: "Shallow", artist: "Lady Gaga & Bradley Cooper" },
    { title: "Bad Romance", artist: "Lady Gaga" },
    { title: "Rolling Stone", artist: "Bob Dylan" },
    { title: "Imagine", artist: "John Lennon" },
    { title: "Hey Jude", artist: "The Beatles" },
    { title: "Let It Be", artist: "The Beatles" }
];
               const quotes = [
    "A persist√™ncia √© o caminho do √™xito. - Charles Chaplin",
    "O sucesso √© a soma de pequenos esfor√ßos repetidos dia ap√≥s dia. - Robert Collier",
    "A vida √© 10% o que acontece comigo e 90% como eu reajo a isso. - Charles R. Swindoll",
    "O √∫nico lugar onde o sucesso vem antes do trabalho √© no dicion√°rio. - Vidal Sassoon",
    "N√£o espere por oportunidades extraordin√°rias. Agarre ocasi√µes comuns e torne-as grandes. - Orison Swett Marden",
    "Acredite que voc√™ pode, assim voc√™ j√° est√° no meio do caminho. - Theodore Roosevelt",
    "A melhor maneira de prever o futuro √© cri√°-lo. - Peter Drucker",
    "Coragem √© a resist√™ncia ao medo, dom√≠nio do medo, n√£o aus√™ncia do medo. - Mark Twain",
    "Voc√™ perde 100% dos tiros que n√£o d√°. - Wayne Gretzky",
    "Grandes esp√≠ritos sempre encontraram violenta oposi√ß√£o de mentes med√≠ocres. - Albert Einstein",
    "O sucesso n√£o √© definitivo, o fracasso n√£o √© fatal: √© a coragem de continuar que conta. - Winston Churchill",
    "A √∫nica limita√ß√£o que voc√™ tem √© aquela que voc√™ acredita ter. - Napoleon Hill",
    "N√£o conte os dias, fa√ßa os dias contarem. - Muhammad Ali",
    "O otimismo √© a f√© que leva √† realiza√ß√£o. Nada pode ser feito sem esperan√ßa e confian√ßa. - Helen Keller",
    "Transforme suas feridas em sabedoria. - Oprah Winfrey",
    "O √∫nico modo de fazer um excelente trabalho √© amar o que voc√™ faz. - Steve Jobs",
    "N√£o √© a montanha que conquistamos, mas a n√≥s mesmos. - Sir Edmund Hillary",
    "Se voc√™ quer algo que nunca teve, precisa fazer algo que nunca fez. - Thomas Jefferson",
    "A felicidade n√£o √© algo pronto. Ela vem de suas pr√≥prias a√ß√µes. - Dalai Lama",
    "Voc√™ n√£o precisa ser √≥timo para come√ßar, mas precisa come√ßar para ser √≥timo. - Zig Ziglar"
];
            };

            const parseMarkdown = (text) => text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\*(.*?)\*/g, '<em>$1</em>');

            const addMessage = (content, isUser = false) => {
                transitionToChatView();
                const messageGroup = document.createElement('div');
                messageGroup.className = `message-group ${isUser ? 'user' : ''}`;
                if (!isUser) messageGroup.innerHTML += `<div class="bot-avatar"><img src="https://i.imgur.com/HPsXQqv.png" alt="Avatar"></div>`;
                
                const bubblesContainer = document.createElement('div');
                bubblesContainer.className = 'message-bubbles';
                const messages = Array.isArray(content) ? content : [content];
                
                messages.forEach(msg => {
                    const bubble = document.createElement('div');
                    bubble.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                    bubble.innerHTML = parseMarkdown(msg);
                    
                    const timestamp = document.createElement('div');
                    timestamp.className = 'message-timestamp';
                    timestamp.textContent = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                    bubble.appendChild(timestamp);

                    bubblesContainer.appendChild(bubble);
                });
                
                messageGroup.appendChild(bubblesContainer);
                elements.chatMessages.appendChild(messageGroup);
                
                if (!isUser) speak(messages.join(' ').replace(/<[^>]*>/g, ''));
            };
            
            const showQuickReplies = (replies) => {
                elements.quickReplyArea.innerHTML = replies.map(reply => `<button class="quick-reply">${reply}</button>`).join('');
                document.querySelectorAll('.quick-reply').forEach(btn => {
                    btn.addEventListener('click', () => {
                        elements.userInput.value = btn.textContent;
                        handleUserInput();
                    });
                });
            };

            const showTypingIndicator = (show = true) => {
                document.querySelectorAll('.typing-indicator').forEach(el => el.remove());
                if (show) {
                    const typingHTML = `<div class="message-group typing-indicator"><div class="bot-avatar"><img src="https://i.imgur.com/HPsXQqv.png" alt="Avatar"></div><div class="message-bubbles"><div class="message bot-message typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div></div>`;
                    elements.chatMessages.insertAdjacentHTML('beforeend', typingHTML);
                    elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
                }
            };
            
            const handleUserInput = (event) => {
                if(event) event.preventDefault();
                const text = elements.userInput.value.trim();
                if (!text) return;
                
                addMessage(text, true);
                elements.userInput.value = '';
                elements.quickReplyArea.innerHTML = '';
                
                setOrbState('thinking');
                const responseDelay = 800 + Math.random() * 800;
                setTimeout(() => generateResponse(text), responseDelay);
            };

            const generateResponse = (input) => {
                showTypingIndicator(false);
                setOrbState('idle');
                const lowerInput = input.toLowerCase();

                if (conversationState === 'WAITING_FOR_NAME') {
                    userName = input.split(' ')[0].replace(/[^a-zA-Z]/g, '');
                    localStorage.setItem('hanabiUserName', userName);
                    conversationState = 'IDLE';
                    addMessage([`Prazer em te conhecer, **${userName}**!`, `O que voc√™ gostaria de fazer?`]);
                    showQuickReplies(["/noticias", "/clima Vit√≥ria", "Me conte uma piada"]);
                    return;
                }
                
                if (conversationState === 'WAITING_FOR_RIDDLE_ANSWER') {
                    if (lowerInput.includes(riddleAnswer)) { addMessage("Parab√©ns, voc√™ acertou! üéâ"); } 
                    else { addMessage(`N√£o foi dessa vez. A resposta era: **${riddleAnswer}**.`); }
                    conversationState = 'IDLE';
                    showQuickReplies(["Me conte uma piada", "/ajuda"]);
                    return;
                }
                
                if (lowerInput.startsWith('/')) { handleCommand(lowerInput); return; }

                const responses = { 
                    'piada': () => knowledgeBase.jokes.random(), 
                    'charada': () => handleCommand('/charada'), 
                    'anime|desenho': () => `Que tal **${knowledgeBase.animes.random().title}**? ${knowledgeBase.animes.random().desc}`, 
                    'm√∫sica|som': () => `Recomendo **${knowledgeBase.musics.random().title}** de ${knowledgeBase.musics.random().artist}.`, 
                    'frase|motiva': () => `Claro! *"${knowledgeBase.quotes.random()}"*`, 
                    'quem √© voc√™|seu nome': () => knowledgeBase.identity, 
                    'obrigad': () => knowledgeBase.gratitude.random(), 
                    'tchau|adeus': () => knowledgeBase.farewell.random(), 
                    'hora': () => `Agora s√£o **${new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}**.`, 
                    'dia|data': () => `Hoje √© **${new Date().toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' })}**.` 
                };
                
                for (const key in responses) { 
                    if (key.split('|').some(k => lowerInput.includes(k))) { 
                        addMessage(responses[key]()); 
                        return; 
                    } 
                }
                
                addMessage(knowledgeBase.fallback);
                showQuickReplies(["/noticias", "/clima", "/ajuda", "Me conte uma piada"]);
            };
            
            const handleCommand = (input) => {
                const [command, ...args] = input.substring(1).split(' ');
                const query = args.join(' ');
                switch(command) {
                    case 'ajuda': 
                        addMessage("<b>Comandos dispon√≠veis:</b><br>**/clima** [cidade]<br>**/noticias**<br>**/buscar** [termo]<br>**/calcular** [opera√ß√£o]<br>**/piada**<br>**/charada**"); 
                        break;
                    case 'piada': 
                        addMessage(knowledgeBase.jokes.random()); 
                        break;
                    case 'charada':
                        const riddle = knowledgeBase.riddles.random();
                        riddleAnswer = riddle.a;
                        conversationState = 'WAITING_FOR_RIDDLE_ANSWER';
                        addMessage([riddle.q, "Qual √© a sua resposta?"]);
                        elements.userInput.focus();
                        break;
                    case 'anime':
                        const anime = knowledgeBase.animes.random();
                        addMessage(`Recomendo: **${anime.title}** - ${anime.desc}`);
                        break;
                    case 'musica':
                        const music = knowledgeBase.musics.random();
                        addMessage(`Que tal ouvir: **${music.title}** de ${music.artist}?`);
                        break;
                    default: 
                        addMessage("Comando n√£o reconhecido. Digite `/ajuda` para ver a lista.");
                }
            };
            
            const initializeSpeech = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) { 
                    elements.micBtn.style.display = 'none'; 
                    return; 
                }
                
                speechRecognition = new SpeechRecognition();
                speechRecognition.lang = 'pt-BR';
                speechRecognition.continuous = false;
                
                speechRecognition.onstart = () => setOrbState('listening');
                speechRecognition.onend = () => setOrbState('idle');
                speechRecognition.onresult = (event) => { 
                    elements.userInput.value = event.results[0][0].transcript; 
                    handleUserInput(); 
                };
                
                speechRecognition.onerror = (event) => {
                    console.error('Erro no reconhecimento de voz:', event.error);
                    setOrbState('idle');
                    addMessage("N√£o consegui entender o que voc√™ disse. Pode repetir?");
                };
            };
            
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'pt-BR';
                    utterance.rate = 1.0;
                    utterance.pitch = 1.0;
                    speechSynthesis.speak(utterance);
                }
            };

            const transitionToChatView = () => {
                if (!isConversationActive) {
                    isConversationActive = true;
                    elements.assistantUI.classList.add('hidden');
                    elements.chatMessages.classList.add('active');
                }
            };
            
            const showToast = (message) => {
                elements.toast.textContent = message;
                elements.toast.classList.add('show');
                setTimeout(() => elements.toast.classList.remove('show'), 3000);
            };

            const toggleTheme = () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('hanabiTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            };

            const setOrbState = (state) => {
                elements.orb.classList.remove('thinking', 'listening');
                elements.orb.innerHTML = '';
                if (state === 'thinking') { 
                    elements.orb.classList.add('thinking'); 
                }
                else if (state === 'listening') {
                    elements.orb.classList.add('listening');
                    elements.orb.innerHTML = '<div class="listening-ring"></div>';
                }
            };
            
            const startApp = () => {
                elements.greetingName.textContent = userName || 'visitante';
                if (!userName) {
                    setTimeout(() => {
                        addMessage(["Ol√°! Eu sou a Sophia.", "Como posso te chamar?"]);
                        conversationState = 'WAITING_FOR_NAME';
                        elements.userInput.focus();
                    }, 500);
                } else {
                    setTimeout(() => {
                        addMessage([`Ol√°, ${userName}! Que bom te ver de novo.`, "Como posso te ajudar hoje?"]);
                        showQuickReplies(["/noticias", "/clima", "Me conte uma piada", "/ajuda"]);
                    }, 500);
                }
            };

            const resetApp = () => {
                elements.chatMessages.innerHTML = '';
                elements.menuOverlay.classList.remove('active');
                localStorage.removeItem('hanabiUserName');
                userName = '';
                showToast("Chat reiniciado!");
                isConversationActive = false;
                elements.assistantUI.classList.remove('hidden');
                elements.chatMessages.classList.remove('active');
                elements.greetingName.textContent = 'visitante';
                startApp();
            };

            const showAboutHanabi = () => {
                elements.menuOverlay.classList.remove('active');
                addMessage([
                    "**Sobre a Yuki**",
                    "Eu sou a Yuki, uma assistente virtual inteligente criada pelo Studio Tsukiyo.",
                    "",
                    "**Recursos:**",
                    "‚Ä¢ Conversa√ß√£o inteligente e natural",
                    "‚Ä¢ Recomenda√ß√µes de animes e m√∫sicas",
                    "‚Ä¢ Piadas e charadas divertidas",
                    "‚Ä¢ Reconhecimento de voz",
                    "‚Ä¢ Interface moderna e responsiva",
                    "",
                    "**Vers√£o 2.0** - Desenvolvida com ‚ù§Ô∏è por **Naoto Dev**"
                ]);
            };

            const showAboutDev = () => {
                elements.menuOverlay.classList.remove('active');
                addMessage("Naoto Dev √© o desenvolvedor por tr√°s da Yuki e de outros projetos do Studio Tsukiyo Platforms. Um entusiasta de tecnologia que cria assistentes inteligentes para melhorar seu dia a dia.");
            };

            // Inicializa√ß√£o do aplicativo
            elements.getStartedBtn.addEventListener('click', () => {
                elements.welcomeScreen.classList.add('hidden');
                elements.chatScreen.classList.remove('hidden');
                startApp();
            });
            
            elements.inputArea.addEventListener('submit', handleUserInput);
            elements.micBtn.addEventListener('click', () => speechRecognition?.start());
            elements.menuBtn.addEventListener('click', () => elements.menuOverlay.classList.add('active'));
            elements.menuOverlay.addEventListener('click', (e) => { 
                if (e.target === e.currentTarget) elements.menuOverlay.classList.remove('active'); 
            });
            
            elements.clearChatBtn.addEventListener('click', resetApp);
            elements.helpBtn.addEventListener('click', () => {
                elements.menuOverlay.classList.remove('active');
                handleCommand('/ajuda');
            });
            
            elements.aboutHanabiBtn.addEventListener('click', showAboutHanabi);
            elements.aboutDevBtn.addEventListener('click', showAboutDev);
            elements.darkModeToggle.addEventListener('change', toggleTheme);

            // Configura√ß√£o inicial do tema
            if (localStorage.getItem('hanabiTheme') === 'dark') {
                document.body.classList.add('dark-mode');
                elements.darkModeToggle.checked = true;
            }
            
            // Inicializar reconhecimento de voz
            initializeSpeech();
        });
    </script>
</body>
</html>
