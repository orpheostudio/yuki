<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sena - Seu Amigo Digital Inteligente</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üëµ</text></svg>">
    
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "SEU_PROJETO_ID_CLARITY");
    </script>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-SEU_ID_ADSENSE"
     crossorigin="anonymous"></script>
    
    <style>
        /* ==================== VARI√ÅVEIS GLOBAIS ==================== */
        :root {
            --font-size-base: 18px;
            --font-size-large: 24px;
            --color-primary: #007BFF;
            --color-secondary-action: #FFA500;
            --color-voice: #FF3B30;
            --color-background: #F0F0F0;
            --color-text: #1A1A1A;
            --color-user-bubble: #DCF8C6;
            --color-ai-bubble: #FFFFFF;
            --color-success: #28a745;
            --transition-speed: 0.3s;
        }

        /* ==================== RESET E TIPOGRAFIA ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Helvetica', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            font-size: var(--font-size-base);
            line-height: 1.5;
            height: 100vh;
            overflow: hidden;
            transition: all var(--transition-speed);
        }

        /* ==================== TELAS DE ONBOARDING ==================== */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            padding: 20px;
        }

        .screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .screen-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .screen-logo {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .screen h1 {
            font-size: 32px;
            color: #667eea;
            margin-bottom: 15px;
        }

        .screen h2 {
            font-size: 28px;
            color: #333;
            margin-bottom: 20px;
        }

        .screen p {
            font-size: 18px;
            color: #555;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .screen-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .screen-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .feature-list {
            text-align: left;
            margin: 20px 0;
        }

        .feature-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .feature-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .terms-links {
            margin-top: 20px;
            font-size: 14px;
        }

        .terms-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 10px;
            font-weight: bold;
        }

        .terms-links a:hover {
            text-decoration: underline;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .checkbox-container input {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-container label {
            font-size: 16px;
            cursor: pointer;
        }

        /* ==================== APP PRINCIPAL ==================== */
        .app-container {
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            height: 100vh;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .app-container.visible {
            opacity: 1;
        }

        /* ==================== HEADER ==================== */
        .header-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-title {
            font-size: 28px;
            font-weight: 700;
            padding: 0;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 5px;
            width: 130px;
            justify-content: flex-end;
        }

        /* ==================== BOT√ïES ==================== */
        .action-button {
            background-color: var(--color-secondary-action);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            width: 130px;
        }

        .action-button:hover {
            background-color: #CC8400;
            transform: translateY(-1px);
        }

        .action-button:active {
            transform: translateY(0);
        }

        .small-button {
            padding: 8px 10px;
            font-size: 14px;
            width: auto;
            box-shadow: none;
        }

        /* ==================== √ÅREA DE CHAT ==================== */
        #chat-area {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 10px;
            scroll-behavior: smooth;
        }

        .message-container {
            display: flex;
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-bubble {
            max-width: 70%;
            padding: 15px;
            border-radius: 12px;
            font-size: var(--font-size-base);
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .user {
            margin-left: auto;
        }

        .user .message-bubble {
            background-color: var(--color-user-bubble);
        }

        .ai {
            margin-right: auto;
        }

        .ai .message-bubble {
            background-color: var(--color-ai-bubble);
            border: 1px solid #DDD;
        }

        /* ==================== INPUT √ÅREA ==================== */
        .input-container {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: white;
            border-top: 1px solid #DDD;
            gap: 10px;
            width: 100%;
            box-sizing: border-box;
        }

        .input-text {
            flex-grow: 1;
            min-height: 60px;
            max-height: 150px;
            padding: 15px;
            border: 2px solid #CCC;
            border-radius: 15px;
            font-size: var(--font-size-large);
            resize: none;
            outline: none;
            font-family: inherit;
        }

        .input-text:focus {
            border-color: var(--color-primary);
        }

        .send-button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 0 25px;
            font-size: var(--font-size-large);
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            height: 60px;
        }

        .send-button:hover:not(:disabled) {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

        .send-button:disabled {
            background-color: #A0A0A0;
            cursor: not-allowed;
        }

        .voice-button {
            background-color: var(--color-voice);
            font-size: 36px;
            width: 70px;
            padding: 0;
        }

        .voice-button:hover:not(:disabled) {
            background-color: #CC0000;
        }

        .voice-button.recording {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0.7); }
            70% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(255, 59, 48, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 59, 48, 0); }
        }

        /* ==================== LOADING ==================== */
        .loading-indicator {
            display: none;
            padding: 15px;
            margin-top: 5px;
            background-color: #EEE;
            border-radius: 12px;
            align-items: center;
            gap: 10px;
            font-size: var(--font-size-base);
            margin-right: auto;
        }

        .loading-indicator.visible {
            display: flex;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--color-primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ==================== WELCOME MESSAGE ==================== */
        #welcome-message {
            text-align: center;
            margin-top: 10%;
            padding: 20px;
        }

        #welcome-message h2 {
            color: var(--color-primary);
            margin-bottom: 15px;
        }

        /* ==================== TEMAS DE ACESSIBILIDADE ==================== */
        .high-contrast {
            --color-primary: #FFFF00;
            --color-background: #000000;
            --color-text: #FFFFFF;
            --color-user-bubble: #1A1A1A;
            --color-ai-bubble: #444444;
            --color-secondary-action: #FF00FF;
            --color-voice: #FF00FF;
        }

        .high-contrast .header-title-container,
        .high-contrast .input-container {
            background-color: #111;
            border-bottom-color: #555;
            border-top-color: #555;
            color: var(--color-text);
        }

        .high-contrast .message-bubble {
            border-color: #AAA;
        }

        .high-contrast .input-text {
            background-color: #000;
            color: #FFF;
            border-color: #888;
        }

        .high-contrast .screen-content {
            background-color: #222;
            color: #FFF;
        }

        .high-contrast .screen h1,
        .high-contrast .screen h2 {
            color: #FFFF00;
        }

        .large-font {
            --font-size-base: 22px;
            --font-size-large: 28px;
        }

        /* ==================== RESPONSIVIDADE ==================== */
        @media (max-width: 600px) {
            .screen-content {
                padding: 30px 20px;
            }

            .screen h1 {
                font-size: 26px;
            }

            .screen h2 {
                font-size: 22px;
            }

            .header-title {
                font-size: 22px;
            }

            .action-button {
                width: 110px;
                font-size: 14px;
            }
        }

        /* ==================== ADSENSE PLACEHOLDER ==================== */
        .ad-container {
            min-height: 90px;
            background-color: #f5f5f5;
            border: 1px dashed #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            font-size: 12px;
            color: #999;
        }
    </style>
</head>
<body>

    <!-- ==================== TELA 1: BOAS-VINDAS ==================== -->
    <div id="welcome-screen" class="screen">
        <div class="screen-content">
            <div class="screen-logo">üëµ</div>
            <h1>Bem-vindo ao Sena!</h1>
            <p>Seu assistente digital amig√°vel e inteligente, criado especialmente para facilitar sua vida com tecnologia.</p>
            <button class="screen-button" onclick="showAboutScreen()">Come√ßar</button>
        </div>
    </div>

    <!-- ==================== TELA 2: SOBRE O PROJETO ==================== -->
    <div id="about-screen" class="screen hidden">
        <div class="screen-content">
            <div class="screen-logo">üí¨</div>
            <h2>O que √© a Sena?</h2>
            <p>Sena √© um chatbot inteligente desenvolvido pela <strong>Orpheo Studio</strong> para ajudar pessoas de todas as idades a interagir com tecnologia de forma simples e natural.</p>
            
            <div class="feature-list">
                <div class="feature-item">
                    <span class="feature-icon">üéôÔ∏è</span>
                    <span><strong>Comandos de Voz:</strong> Converse naturalmente usando sua voz</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üé®</span>
                    <span><strong>Acessibilidade Total:</strong> Alto contraste e fontes ajust√°veis</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ü§ñ</span>
                    <span><strong>IA Avan√ßada:</strong> Respostas inteligentes e contextuais</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üîí</span>
                    <span><strong>Privacidade:</strong> Suas conversas s√£o seguras</span>
                </div>
            </div>
            
            <button class="screen-button" onclick="showTermsScreen()">Continuar</button>
        </div>
    </div>

    <!-- ==================== TELA 3: TERMOS E POL√çTICAS ==================== -->
    <div id="terms-screen" class="screen hidden">
        <div class="screen-content">
            <div class="screen-logo">üìã</div>
            <h2>Antes de Prosseguir</h2>
            <p>Para usar a Sena, voc√™ precisa concordar com nossos Termos de Uso e Pol√≠tica de Privacidade.</p>
            
            <div class="terms-links">
                <a href="https://termos.orpheostudio.com.br" target="_blank">üìÑ Termos de Uso</a>
                <a href="https://politicas.orpheostudio.com.br" target="_blank">üîê Pol√≠tica de Privacidade</a>
            </div>
            
            <div class="checkbox-container">
                <input type="checkbox" id="terms-checkbox">
                <label for="terms-checkbox">Li e concordo com os termos e pol√≠ticas</label>
            </div>
            
            <button class="screen-button" id="accept-button" onclick="startApp()" disabled>Aceitar e Come√ßar</button>
        </div>
    </div>

    <!-- ==================== APP PRINCIPAL ==================== -->
    <div class="app-container" id="main-app">
        <div class="header-title-container">
            <button id="clear-button" class="action-button">üîÑ Novo Chat</button>
            <div class="header-title">üí¨ Sena Amig√°vel</div>
            <div class="header-actions">
                <button id="contrast-button" class="action-button small-button">Ajuste Cor</button>
                <button id="font-button" class="action-button small-button">A+</button>
            </div>
        </div>

        <!-- AdSense Banner (Substitua pelo seu c√≥digo real) -->
        <div class="ad-container">
            <!-- <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-SEU_ID_ADSENSE"
                 data-ad-slot="SEU_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins> -->
            Espa√ßo para An√∫ncio Google AdSense
        </div>

        <div id="chat-area">
            <div id="welcome-message">
                <h2>Ol√°! Eu sou o Sena! üëã</h2>
                <p style="font-size: 20px;">Comece digitando uma pergunta simples ou use o microfone (üéôÔ∏è) para falar comigo.</p>
                <p style="font-size: 16px; color: #666;">Exemplos: "Como fa√ßo para ligar para algu√©m?" ou "Me explique o que √© WhatsApp"</p>
            </div>
            
            <div id="loading-indicator" class="loading-indicator">
                <div class="spinner"></div>
                <span id="loading-text">Sena est√° pensando...</span>
            </div>
        </div>

        <div class="input-container">
            <textarea
                id="input-text"
                class="input-text"
                placeholder="Digite sua pergunta aqui ou toque no microfone..."
                rows="1"
            ></textarea>
            
            <button id="voice-button" class="send-button voice-button">üéôÔ∏è</button>
            <button id="send-button" class="send-button">ENVIAR</button>
        </div>
    </div>

    <script>
        // ==================== CONFIGURA√á√ÉO DA API ====================
        const MISTRAL_API_KEY = "SUA_CHAVE_API_DA_MISTRAL_AQUI"; // ‚ö†Ô∏è SUBSTITUA
        const MISTRAL_API_ENDPOINT = "https://api.mistral.ai/v1/chat/completions";
        const MISTRAL_MODEL = "mistral-small-latest"; // Modelo mais avan√ßado

        // ==================== REFER√äNCIAS DOM ====================
        const welcomeScreen = document.getElementById('welcome-screen');
        const aboutScreen = document.getElementById('about-screen');
        const termsScreen = document.getElementById('terms-screen');
        const mainApp = document.getElementById('main-app');
        const termsCheckbox = document.getElementById('terms-checkbox');
        const acceptButton = document.getElementById('accept-button');
        
        const chatArea = document.getElementById('chat-area');
        const inputTextarea = document.getElementById('input-text');
        const sendButton = document.getElementById('send-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const welcomeMessage = document.getElementById('welcome-message');
        const voiceButton = document.getElementById('voice-button');
        const clearButton = document.getElementById('clear-button');
        const contrastButton = document.getElementById('contrast-button');
        const fontButton = document.getElementById('font-button');
        const bodyElement = document.body;

        let isProcessing = false;

        // ==================== SUPORTE A VOZ ====================
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const isSpeechSupported = !!SpeechRecognition;
        
        if (!isSpeechSupported) {
            voiceButton.style.display = 'none';
        }

        // ==================== FUN√á√ïES DE NAVEGA√á√ÉO ENTRE TELAS ====================
        function showAboutScreen() {
            welcomeScreen.classList.add('hidden');
            setTimeout(() => aboutScreen.classList.remove('hidden'), 300);
        }

        function showTermsScreen() {
            aboutScreen.classList.add('hidden');
            setTimeout(() => termsScreen.classList.remove('hidden'), 300);
        }

        function startApp() {
            if (!termsCheckbox.checked) return;
            
            localStorage.setItem('sena-terms-accepted', 'true');
            termsScreen.classList.add('hidden');
            
            setTimeout(() => {
                mainApp.classList.add('visible');
                loadPreferences();
                initializeAdSense();
            }, 300);
        }

        // ==================== VERIFICA√á√ÉO DE TERMOS ACEITOS ====================
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('sena-terms-accepted') === 'true') {
                welcomeScreen.classList.add('hidden');
                aboutScreen.classList.add('hidden');
                termsScreen.classList.add('hidden');
                mainApp.classList.add('visible');
                loadPreferences();
                initializeAdSense();
            }
        });

        termsCheckbox.addEventListener('change', () => {
            acceptButton.disabled = !termsCheckbox.checked;
        });

        // ==================== INICIALIZAR ADSENSE ====================
        function initializeAdSense() {
            // (adsbygoogle = window.adsbygoogle || []).push({});
            console.log('AdSense inicializado (substitua pelo c√≥digo real)');
        }

        // ==================== CLASSE DE GERENCIAMENTO DO CHAT ====================
        class ChatManager {
            constructor() {
                this.history = [];
                this.systemInstruction = {
                    role: "system",
                    content: `Voc√™ √© a Sena, uma assistente virtual extremamente amig√°vel e paciente, especialmente desenvolvida para pessoas idosas ou com pouca familiaridade com tecnologia.

DIRETRIZES FUNDAMENTAIS:
1. Use linguagem MUITO simples e clara. Evite jarg√µes t√©cnicos completamente.
2. Respostas devem ser CURTAS e DIRETAS (m√°ximo 3-4 frases).
3. Use analogias do dia a dia para explicar conceitos tecnol√≥gicos.
4. Seja EXTREMAMENTE paciente e encorajadora.
5. Confirme compreens√£o perguntando se a explica√ß√£o ficou clara (mas n√£o sempre).
6. Nunca assuma conhecimento pr√©vio de tecnologia.
7. Use emojis apropriados para deixar a conversa mais amig√°vel üòä
8. Divida instru√ß√µes complexas em passos numerados muito simples.
9. Se a pergunta for amb√≠gua, fa√ßa perguntas esclarecedoras gentis.
10. Mantenha um tom caloroso, como se fosse um neto/neta ajudando.

PROCESSAMENTO DE LINGUAGEM NATURAL (NLP):
- Identifique inten√ß√µes mesmo com erros de digita√ß√£o ou gram√°tica.
- Reconhe√ßa varia√ß√µes regionais e g√≠rias comuns no portugu√™s brasileiro.
- Interprete contexto emocional e responda com empatia adequada.
- Se detectar frustra√ß√£o, seja extra paciente e ofere√ßa alternativas mais simples.

EXEMPLOS DE BOM ATENDIMENTO:
‚ùå "Para realizar a autentica√ß√£o do seu dispositivo..."
‚úÖ "Para confirmar que √© voc√™ mesmo, vamos fazer um passo bem simples..."

‚ùå "Acesse as configura√ß√µes atrav√©s do menu hamb√∫rguer..."
‚úÖ "Toque no √≠cone das tr√™s barrinhas no canto da tela üì±"

Lembre-se: Voc√™ n√£o √© apenas uma IA, voc√™ √© uma amiga digital que est√° aqui para ajudar com carinho e paci√™ncia infinita! üíô`
                };
            }

            addMessage(text, sender) {
                const message = {
                    role: sender === 'user' ? 'user' : 'assistant',
                    content: text
                };
                this.history.push(message);
                
                // Limitar hist√≥rico a 20 mensagens para n√£o exceder limites da API
                if (this.history.length > 20) {
                    this.history = this.history.slice(-20);
                }
                
                return message;
            }

            clearHistory() {
                this.history = [];
            }

            async getAiResponse() {
                if (MISTRAL_API_KEY === "SUA_CHAVE_API_DA_MISTRAL_AQUI") {
                    return "‚ö†Ô∏è A chave da API da Mistral n√£o foi configurada. Por favor, adicione sua chave no c√≥digo para eu poder funcionar corretamente!";
                }

                try {
                    const payloadMessages = [this.systemInstruction, ...this.history];

                    const response = await fetch(MISTRAL_API_ENDPOINT, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${MISTRAL_API_KEY}`,
                        },
                        body: JSON.stringify({
                            model: MISTRAL_MODEL,
                            messages: payloadMessages,
                            temperature: 0.7,
                            max_tokens: 500, // Respostas concisas
                            top_p: 0.9,
                            safe_prompt: true
                        }),
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ message: response.statusText }));
                        throw new Error(`Erro da API (${response.status}): ${errorData.message || response.statusText}`);
                    }

                    const data = await response.json();
                    
                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        return data.choices[0].message.content;
                    }
                    
                    return "Desculpe, tive um problema para entender isso. Pode tentar de novo? üòä";
                    
                } catch (error) {
                    console.error("Erro ao chamar API:", error);
                    throw error;
                }
            }
        }

        const chatManager = new ChatManager();

        // ==================== FUN√á√ïES DE INTERFACE ====================
        function scrollToBottom() {
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function toggleLoading(loading) {
            isProcessing = loading;
            inputTextarea.disabled = loading;
            sendButton.disabled = loading || inputTextarea.value.trim() === '';
            voiceButton.disabled = loading;
            
            if (loading) {
                loadingIndicator.classList.add('visible');
                scrollToBottom();
            } else {
                loadingIndicator.classList.remove('visible');
            }
        }

        function displayMessage(text, sender) {
            if (sender === 'user') {
                chatManager.addMessage(text, sender);
            }

            if (welcomeMessage && welcomeMessage.style.display !== 'none') {
                welcomeMessage.style.display = 'none';
            }

            const messageContainer = document.createElement('div');
            messageContainer.appendChild(messageBubble);
            chatArea.appendChild(messageContainer);
            
            scrollToBottom();
        }

        // ==================== FUN√á√ÉO PRINCIPAL DE ENVIO ====================
        async function handleSend() {
            const text = inputTextarea.value.trim();
            if (!text || isProcessing) return;

            try {
                toggleLoading(true);
                
                displayMessage(text, 'user');
                inputTextarea.value = '';
                
                const aiResponse = await chatManager.getAiResponse();
                
                chatManager.addMessage(aiResponse, 'ai');
                displayMessage(aiResponse, 'ai');

            } catch (error) {
                console.error("Erro no chat:", error);
                const errorMessage = `Ops! Tive um problema para responder üòî\n\nErro: ${error.message}\n\nDicas:\n‚Ä¢ Verifique se sua chave da API est√° configurada\n‚Ä¢ Confirme sua conex√£o com a internet\n‚Ä¢ Tente novamente em alguns segundos`;
                displayMessage(errorMessage, 'ai');
            } finally {
                toggleLoading(false);
            }
        }

        // ==================== LIMPAR CHAT ====================
        function handleClearChat() {
            if (confirm("Tem certeza que deseja come√ßar um Novo Chat? Todo o hist√≥rico ser√° apagado.")) {
                chatManager.clearHistory();
                
                const messages = chatArea.querySelectorAll('.message-container');
                messages.forEach(msg => msg.remove());
                
                welcomeMessage.style.display = 'block';
                toggleLoading(false);
                inputTextarea.value = '';
                sendButton.disabled = true;
            }
        }

        // ==================== RECONHECIMENTO DE VOZ ====================
        function startVoiceRecognition() {
            if (!isSpeechSupported || isProcessing) return;

            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            voiceButton.classList.add('recording');
            inputTextarea.placeholder = "üéôÔ∏è Escutando... Fale agora!";

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                inputTextarea.value = transcript;
                handleSend();
            };

            recognition.onend = () => {
                voiceButton.classList.remove('recording');
                inputTextarea.placeholder = isProcessing 
                    ? "Aguardando resposta..." 
                    : "Digite sua pergunta aqui ou toque no microfone...";
            };

            recognition.onerror = (event) => {
                console.error('Erro de Reconhecimento de Voz:', event.error);
                voiceButton.classList.remove('recording');
                inputTextarea.placeholder = "Digite sua pergunta aqui ou toque no microfone...";
                
                let errorMsg = "Erro ao usar o microfone.";
                if (event.error === 'no-speech') {
                    errorMsg = "N√£o consegui ouvir nada. Tente novamente! üéôÔ∏è";
                } else if (event.error === 'not-allowed') {
                    errorMsg = "Permiss√£o do microfone negada. Ative nas configura√ß√µes do navegador! üîí";
                }
                
                alert(errorMsg);
            };

            recognition.start();
        }

        // ==================== ACESSIBILIDADE - CONTRASTE ====================
        function toggleContrast() {
            bodyElement.classList.toggle('high-contrast');
            const isHighContrast = bodyElement.classList.contains('high-contrast');
            localStorage.setItem('sena-contrast', isHighContrast ? 'on' : 'off');
            contrastButton.textContent = isHighContrast ? 'Contraste ON' : 'Ajuste Cor';
        }

        // ==================== ACESSIBILIDADE - FONTE ====================
        function toggleFontSize() {
            bodyElement.classList.toggle('large-font');
            const isLargeFont = bodyElement.classList.contains('large-font');
            localStorage.setItem('sena-font', isLargeFont ? 'large' : 'default');
            fontButton.textContent = isLargeFont ? 'A++' : 'A+';
        }

        // ==================== CARREGAR PREFER√äNCIAS ====================
        function loadPreferences() {
            if (localStorage.getItem('sena-contrast') === 'on') {
                bodyElement.classList.add('high-contrast');
                contrastButton.textContent = 'Contraste ON';
            }
            
            if (localStorage.getItem('sena-font') === 'large') {
                bodyElement.classList.add('large-font');
                fontButton.textContent = 'A++';
            }
        }

        // ==================== EVENT LISTENERS ====================
        clearButton.addEventListener('click', handleClearChat);
        sendButton.addEventListener('click', handleSend);
        contrastButton.addEventListener('click', toggleContrast);
        fontButton.addEventListener('click', toggleFontSize);

        if (isSpeechSupported) {
            voiceButton.addEventListener('click', startVoiceRecognition);
        }

        inputTextarea.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });

        inputTextarea.addEventListener('input', () => {
            sendButton.disabled = inputTextarea.value.trim() === '' || isProcessing;
            
            // Auto-resize do textarea
            inputTextarea.style.height = 'auto';
            inputTextarea.style.height = Math.min(inputTextarea.scrollHeight, 150) + 'px';
        });

        // ==================== INICIALIZA√á√ÉO ====================
        window.addEventListener('load', () => {
            sendButton.disabled = true;
        });

        // ==================== TRACK DE EVENTOS MICROSOFT CLARITY ====================
        function trackClarityEvent(eventName, eventData = {}) {
            if (window.clarity) {
                window.clarity("event", eventName, eventData);
            }
        }

        // Tracking de eventos importantes
        sendButton.addEventListener('click', () => {
            trackClarityEvent("message_sent", { method: "button" });
        });

        voiceButton.addEventListener('click', () => {
            trackClarityEvent("voice_activated");
        });

        clearButton.addEventListener('click', () => {
            trackClarityEvent("chat_cleared");
        });

        contrastButton.addEventListener('click', () => {
            trackClarityEvent("contrast_toggled", { 
                state: bodyElement.classList.contains('high-contrast') ? 'on' : 'off' 
            });
        });

        fontButton.addEventListener('click', () => {
            trackClarityEvent("font_toggled", { 
                state: bodyElement.classList.contains('large-font') ? 'large' : 'default' 
            });
        });

        // Track quando termos s√£o aceitos
        function trackTermsAccepted() {
            trackClarityEvent("terms_accepted");
        }

        acceptButton.addEventListener('click', trackTermsAccepted);
    </script>
</body>
</html>className = `message-container ${sender}`;

            const messageBubble = document.createElement('div');
            messageBubble.className = 'message-bubble';
            messageBubble.textContent = text;
            
            messageContainer.